<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Akash Nair &middot; Sky Wide 
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="index home">

    <div id="sidebar">
  <header>
    <h1 class="site-title">
      <a href="/">
        
        Akash Nair
      </a>
    </h1>
    <p class="lead">I am a DevOps Engineer and an automation extremist. I design, build and implement architectures on the cloud</p>
  </header>
  <nav id="sidebar-nav-links">
  
  

  

  <div id="profile-container">
     <center><image height=190 width=190 id="profileImage" src="/assets/images/avatar.png" /></center>
  </div>

  <!-- Icons downloaded from https://iconmonstr.com/ -->
  <!-- Home link sidebar-->
  <a id="home-link"
       title="Home" aria-label="Home"
       href="/">
       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M15.5 14.625c0 .484-.387.875-.864.875h-5.273c-.477 0-.863-.392-.863-.875s.387-.875.863-.875h5.272c.478 0 .865.391.865.875zm-6.191-4.375h2.466c.448 0 .809-.392.809-.875s-.361-.875-.81-.875h-2.465c-.447 0-.809.392-.809.875s.362.875.809.875zm14.691 1.75c0 6.627-5.373 12-12 12s-12-5.373-12-12 5.373-12 12-12 12 5.373 12 12zm-5-1.039c0-.383-.311-.692-.691-.692h-1.138c-.583 0-.69-.446-.69-.996-.001-2.36-1.91-4.273-4.265-4.273h-2.952c-2.355 0-4.264 1.913-4.264 4.272v5.455c0 2.36 1.909 4.273 4.264 4.273h5.474c2.353 0 4.262-1.913 4.262-4.272v-3.767z"/></svg>
       Home
    </a>

  <!--LinkedIn link sidebar-->
  <a id="linkedin-link"
       title="LinkedIn" aria-label="LinkedIn"
       href="https://www.linkedin.com/in/akashnair/" target="_blank">
       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-2 8c0 .557-.447 1.008-1 1.008s-1-.45-1-1.008c0-.557.447-1.008 1-1.008s1 .452 1 1.008zm0 2h-2v6h2v-6zm3 0h-2v6h2v-2.861c0-1.722 2.002-1.881 2.002 0v2.861h1.998v-3.359c0-3.284-3.128-3.164-4-1.548v-1.093z"/></svg>       
       LinkedIn
    </a>

  <!--Github link sidebar-->
  <a id="github-link"
       title="GitHub" aria-label="GitHub Profile"
       href="https://github.com/slashr" target="_blank">      
       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
       GitHub
    </a>

 <!-- Resume link sidebar-->
  <a id="Resume-link"
       title="Resume" aria-label="Resume"
       href="/assets/Akash-Nair-Resume.pdf">
       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M23.995 24h-1.995c0-3.104.119-3.55-1.761-3.986-2.877-.664-5.594-1.291-6.584-3.458-.361-.791-.601-2.095.31-3.814 2.042-3.857 2.554-7.165 1.403-9.076-1.341-2.229-5.413-2.241-6.766.034-1.154 1.937-.635 5.227 1.424 9.025.93 1.712.697 3.02.338 3.815-.982 2.178-3.675 2.799-6.525 3.456-1.964.454-1.839.87-1.839 4.004h-1.995l-.005-1.241c0-2.52.199-3.975 3.178-4.663 3.365-.777 6.688-1.473 5.09-4.418-4.733-8.729-1.35-13.678 3.732-13.678 4.983 0 8.451 4.766 3.732 13.678-1.551 2.928 1.65 3.624 5.09 4.418 2.979.688 3.178 2.143 3.178 4.663l-.005 1.241zm-13.478-6l.91 2h1.164l.92-2h-2.994zm2.995 6l-.704-3h-1.615l-.704 3h3.023z"/></svg>
       Resume
    </a>


 <!-- 


  

  
    
      <a class="page-link "
          href="/about.html">About</a>
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  


  


  

  
    
  

  
    
      <a class="category-link "
          href="/category/edge-case.html">Edge Case</a>
    
  

  
    
  

  

  
    
      <a class="category-link "
          href="/category/markup.html">Markup</a>
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  
-->

  <!-- Optional additional links to insert in sidebar nav -->
</nav>



 <!-- <nav id="sidebar-icon-links">
<!--
    <a id="github-link"
       class="icon" title="Github Project" aria-label="Github Project"
       href="https://github.com/slashr">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
    </a>
    <a id="github-download-link"
       class="icon" title="Download" aria-label="Download"
       href="https://github.com/slashr/archive/v.zip">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>

 <!-- <p>
 <!--font size="1"> &copy; 2019 All rights reserved.</font-->
  <!--<a href="/LICENSE.md">MIT License.</a>-->
</p>
 
</div>


    <main class="container">
      <div class="content">
  


  

  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/jenkins-kaniko-kubernetes-cloud-ci-cd/">
        Jenkins, Kubernetes, Kaniko: The Cloud CI/CD trifecta
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">24 Jun 2019</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        Automation
      
    
  </span>
</div>


    
      <p>Running Jenkins on Kubernetes unleashes the scalability powers of Jenkins and makes it easier to replicate and set it up. It involves running a Jenkins Master server (<a href="https://hub.docker.com/r/jenkinsci/blueocean">jenkinsci/blueocean</a>) as a StatefulSet and connecting it with the Kubernetes cluster so that the master can spawn “jenkins slaves” on the K8S cluster whenever a build job is triggered. These slaves are nothing but K8S pods consisting of containers based on the <a href="https://hub.docker.com/r/jenkinsci/jnlp-slave">jenkinsci/jnlp-slave</a> docker image from Docker Hub.</p>

<p>Without further ado, here’s how you can run Jenkins on Kubernetes:</p>
<ol>
  <li>Create a Dockerfile for Jenkins master based on <code class="highlighter-rouge">jenkinsci/blueocean</code> and install the Kuberentes plug in inside it along with any other optional plug-ins.
    <ul>
      <li>Example: <a href="https://github.com/slashr/jenkins-on-kubernetes/blob/master/Dockerfile.jenkins.master">Dockerfile.jenkins.master</a></li>
    </ul>
  </li>
</ol>

<p>Build this image and push it to a docker registry</p>

<ol>
  <li>
    <p>Next deploy the Jenkins master image on a pod on Kubernetes. Note that although you can create a normal kuberentes <code class="highlighter-rouge">Deployment</code> for this, it is recommended that you create a <code class="highlighter-rouge">StatefulSet</code> instead. This ensures the state and configuration of the pod is maintained. In addition to it being a StatefulSet a <code class="highlighter-rouge">PersistentVolume</code> and a <code class="highlighter-rouge">PersistentVolumeClaim</code> is required to maintain the data stored inside the Jenkins master. With the above setup, even if we terminate the pods running Jenkins master, the state and data will persist and the new pod will launch with the existing settings in place. 
PersistentVolume can be created and mounted in the following way: 
Refer to this manifest to understand how to setup a PV and PVC: <a href="https://github.com/slashr/jenkins-on-kubernetes/blob/master/persistent-volume.yaml">persistent-volume.yaml</a>
Make sure to replace <code class="highlighter-rouge">spec.awsElasticBlockStore.volumeID</code> with your own EBS volume ID.</p>
  </li>
  <li>Next, create a service for the master Jenkins server and the slaves. Service type for master should be <code class="highlighter-rouge">LoadBalancer</code> and for slaves should be <code class="highlighter-rouge">ClusterIP</code>. The ports required on the master are 80 (optionally 443) and on the slaves port 50000 (default JNLP port for communication between master and the slave). Refer the following file: <a href="https://github.com/slashr/jenkins-on-kubernetes/blob/master/jenkins-service.yml">jenkins-service.yml</a></li>
  <li>Open the Jenkins dashboard using the LoadBalancer URL of the master Jenkins pod and go to system configuration. At the end of the page, click on <code class="highlighter-rouge">Add a New Cloud</code> and click on Kubernetes.</li>
  <li>Enter the Kubernetes <code class="highlighter-rouge">Cluster API</code> in <code class="highlighter-rouge">Kubernetes URL</code>, username/password of the cluster in the <code class="highlighter-rouge">credentials</code> section, and <code class="highlighter-rouge">ClusterIP</code> of the slave service in <code class="highlighter-rouge">Jenkins Tunnel</code>. This integrates our Jenkins server with the Kubernetes cluster and enables it to launch slave pods on it</li>
  <li>Next, we need to define the pod template for the slaves that will build our application. This is best done from inside the Jenkinsfile. You can find the Jenkinsfile template here: <a href="https://github.com/slashr/jenkins-on-kubernetes/blob/master/Jenkinsfile">Jenkinsfile</a> 
As you can see, we have three containers running in the pod.
    <ul>
      <li>Kaniko: For building our docker images and pushing them to our ECR registry</li>
      <li>kubectl: To deploy our application on Kubernetes</li>
      <li>jnlp-slave: The jenkins slave container although not defined in the Jenkinsfile is automatically created inside the pod by Jenkins master.</li>
    </ul>
  </li>
</ol>

<p>We have four volumes:</p>
<ul>
  <li>kube-config: It’s the ~/.kube/config file of your Kubernetes cluster and is mounted on the kubectl container for authentication to the K8S cluster</li>
  <li>aws-secret: It’s the ~/.aws/credentials file required by Kaniko to authenticate with ECR and publish the docker images</li>
  <li>podlabel: this is a variable we use to uniquely name the pods that will be spawned. If we don’t use it, then there are problems creating pods parallel for each job in the queue.</li>
  <li>docker-config: It’s a simple JSON file consisting of the ECR registry endpoint. Example: <a href="https://github.com/slashr/jenkins-on-kubernetes/blob/master/docker-registry-config.yaml">https://github.com/slashr/jenkins-on-kubernetes/blob/master/docker-registry-config.yaml</a>
Note that for registries other an ECR such as GCR, you would need an additional “authentication token” inside this file.</li>
</ul>

<ol>
  <li><strong>Connecting Jenkins with the Kubernetes cluster</strong>
To provide Jenkins access to the Kubernetes cluster so that it can create pods for every build job, perform the following steps
    <ol>
      <li>Click on <strong>Manage Jenkins</strong> on the Jenkins homepage and then click on <strong>Configure System</strong></li>
      <li>Disable the workers on the master Jenkins pod <strong># of executors</strong> to 0. This ensures that build jobs are run solely on slaves and not on the master</li>
      <li>Scroll down to the end of the page and click on <strong>Add a new cloud</strong> and then click on Kubernetes.</li>
      <li>Enter
        <ul>
          <li><strong>Name</strong> for the cluster</li>
          <li><strong>Kubernetes URL</strong> E.g https://api.kube-cluster.example.com. You can find your API endpoint by running <code class="highlighter-rouge">kubectl cluster-info</code></li>
          <li><strong>Kubernetes Namespace</strong>: It’s the namespace where you deployed your Jenkins master pod</li>
          <li><strong>Credentials</strong>: Enter the username/password of your cluster (located in ~/.kube/config). Click on <strong>Test Connection</strong> to see if the credentials are correct and Jenkins is able to connect to Kubernetes.</li>
          <li><strong>Jenkins URL</strong>: Enter the endpoint of your Jenkins Master service (could be an ELB URL or a custom domain)</li>
          <li><strong>Jenkins Tunnel</strong>: Enter the endpoint of your Jenkins Slave service created earlier. It’s usually a cluster IP along with a port (usually 5000). It should look like 100.76.43.23:50000. The Jenkins master connects to the Kubernetes cluster using this endpoint.</li>
        </ul>
      </li>
    </ol>
  </li>
</ol>

<p>Leave everything else as it is and then click on <strong>Save</strong>.</p>

<ol>
  <li>Now that Jenkins and Kubernetes setup is complete, we can create a Multibranch Pipeline and see the pods being spawned for builds in action! Simply click on <strong>New Item</strong> on the Jenkins Homepage, enter a name for the project and click on <strong>Multibranch Pipeline</strong> and click OK.</li>
  <li>Click on <strong>Add Source</strong> and your git repository. Click on Save and then Jenkins will start scanning your repository and adding all branches which contain a Jenkinsfile in the root directory.</li>
  <li>That’s it! You will see a few pods being spawned already for the new branches. From now onwards, pods will be spawned on Kubernetes for every build and terminated after the build is finished</li>
</ol>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/fire-suppression-using-smart-sensors-iot/">
        Suppressing Fires using Gas: An IoT Experiment
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">17 Mar 2018</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        Automation
      
    
  </span>
</div>


    
      <p>An IoT experiment to create a gas based suppression system that can be used to extinguish fires inside water sensitive enclosures such as data centers. We make use of Arduino microcontrollers and several sensors to create this system.</p>

<center><img src="/assets/images/arduino-logo.svg" height="400" width="400" /></center>


    

    
      
      
      

      
        <a href="/fire-suppression-using-smart-sensors-iot/"></a>
      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/using-lambda-turn-off-ec2-instances/">
        Using Lambda to Turn Off EC2 Instances During Off Hours
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">24 Nov 2016</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        Automation
      
    
      &bull;

      
      
      

      
        AWS
      
    
      &bull;

      
      
      

      
        Ops
      
    
  </span>
</div>


    
      <p>A major part of your AWS bills comes from EC2 uptime and EBS storage use. In order to save on these costs, it is recommended to stop your instances whenever it is not required. Often times, your Development, Test or UAT environments aren’t used by developers during off-hours. Thus this would be a great time frame to temporarily stop the instances and save up on costs.</p>

<p>In order to do this, we can make use of AWS Lambda, which lets you run your code or without setting up any servers. Since it charges based on the compute time taken up by the code, it is very cost efficient. A task running twice within a 24-hour cycle for typically less than 60 seconds with memory consumption up to 128MB (like the script in this post) typically costs around $0.008 per month.</p>

<p>We will use the official AWS SDK for Python, boto3 to write our script and then run it using Lambda functions.</p>


    

    
      
      
      

      
        <a href="/using-lambda-turn-off-ec2-instances/"></a>
      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/rds-read-replica-aurora-mysql/">
        RDS Read Replica for Aurora using MySQL
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">07 Sep 2016</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        AWS
      
    
      &bull;

      
      
      

      
        Ops
      
    
  </span>
</div>


    
      <p>Default Read Replicas provided by AWS are instances which should be of the same instance type as the master DB or higher. This might not always be an ideal solution since read replica servers do not require significant computing power. As an alternative, one can create a read replica on a standalone EC2 instance or a RDS DB instance. In the following scenario, we’ll create a read replica running on MySQL syncing with a master DB running on Amazon Aurora. The replica instance type can be any type as seen fit by the user.</p>


    

    
      
      
      

      
        <a href="/rds-read-replica-aurora-mysql/"></a>
      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/docker/">
        Docker: Install, Build an Image and Publish to DockerHub
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">20 Jul 2016</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        Automation
      
    
      &bull;

      
      
      

      
        Ops
      
    
  </span>
</div>


    
      <p>Docker is a <a href="https://en.wikipedia.org/wiki/Operating-system-level_virtualization">container technology</a> that provides a <strong>layer of abstraction</strong> on the OS that it is installed on(Linux or Windows). It allows the packaging of a software application into a <strong>image</strong> which consists of everything the software requires to run: code, system utilities, third party libraries and other dependencies. Then this image is run on the common <strong>layer of abstraction</strong> defined above. Therefore, it becomes easy to move and deploy the software application (which refers to the <strong>container</strong>) across any infrastructure or environment.</p>

<p><strong><em>Updated: August, 2018</em></strong></p>


    

    
      
      
      

      
        <a href="/docker/"></a>
      
    
  </article>
  

  
<div class="pagination">
  <a class="pagination-item older"
     href="/page2">
    Older
  </a>
</div>


</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
