---
id: 597
title: 'Docker: Install, Build an Image and Publish to DockerHub'
date: 2016-07-20T11:34:36+00:00
author: Akash
layout: post
guid: http://skywide.in/blog/?p=597
permalink: /docker/
image: /wp-content/uploads/2016/07/large_v-trans.png
categories:
  - Automation
  - Ops
tags:
  - automation
  - container
  - devops
  - docker
---
#### About Docker

Docker is a [container technology](https://en.wikipedia.org/wiki/Operating-system-level_virtualization) that provides a **layer of abstraction** on the OS that it is installed on(Linux or Windows). It allows the packaging of a software application into a **image** which consists of everything the software requires to run: code, system utilities, third party libraries and other dependencies. Then this image is run on the &#8220;layer of abstraction&#8221; defined above. Therefore, it becomes easy to move and deploy the software application (which refers to the **container**) across any infrastructure or environment.

* * *

#### Pre-requisites:

  * Ubuntu 16.04 LTS 64-bit version. (Docker does not run on 32 bit)
  * Kernel version 3.10 and above. Check current kernel version using uname -r

* * *

#### Installation

##### The Easy Way

  1. wget -qO- https://get.docker.com/ | sh

OR

##### The Longer Way (in case the easy way doesn&#8217;t work out)

  1. Update APT sources & enable APT to work with HTTPS: <ul style="list-style-type: square;">
      <li>
        <code>apt-get update</code>
      </li>
      <li>
        <code>apt-&lt;span class="hljs-keyword">get&lt;/span> &lt;span class="hljs-keyword">install&lt;/span> apt-transport-https ca-certificates</code>
      </li>
    </ul>

  2. Add the GPG keys: <ul style="list-style-type: square;">
      <li>
        <code>apt-key adv --keyserver hkp:&lt;span class="hljs-regexp">//p&lt;/span>8&lt;span class="hljs-number">0&lt;/span>.pool.sks-keyservers.net:&lt;span class="hljs-number">80&lt;/span> --&lt;span class="hljs-keyword">recv&lt;/span>-&lt;span class="hljs-keyword">keys&lt;/span> &lt;span class="hljs-number">58118&lt;/span>E89F3A912897C070ADBF76221572C52609D</code>
      </li>
    </ul>

  3. Create a file`/etc/apt/sources.list.d/docker.list` and add the following <ul style="list-style-type: square;">
      <li>
        <code>deb https://apt.dockerproject.org/repo ubuntu-xenial main</code>
      </li>
    </ul>

  4. Close the file and run <ul style="list-style-type: square;">
      <li>
        <code>apt-get update</code>
      </li>
    </ul>

  5. Install the following package (it usually would be already installed) <ul style="list-style-type: square;">
      <li>
        <code>apt-get install linux-image-extra-$(uname -r)</code>
      </li>
    </ul>

  6. Install Docker <ul style="list-style-type: square;">
      <li>
        <code>apt-get install docker-engine</code>
      </li>
    </ul>

* * *

#### Running Docker

  1. Start Docker and test if it installed correctly. The second command will download the &#8220;hello-world&#8221; image form DockerHub, creates a container and runs it. <ul style="list-style-type: square;">
      <li>
        <code>service docker start</code>
      </li>
      <li>
        <code>docker run hello-world</code>
      </li>
    </ul>

  2. To view all the containers on the system, type <ul style="list-style-type: square;">
      <li>
        <code>docker ps -a</code>
      </li>
    </ul>

  3. Try downloading and running the whalesay image from DockerHub. In order to do this, first create an account on [DockerHub](https://hub.docker.com/) and search for the image docker/whalesay. On the image page, you&#8217;ll find instructions on usage. For whalesay, use the following command <ul style="list-style-type: square;">
      <li>
        <code>docker run docker/whalesay cowsay boo</code>
      </li>
    </ul>

  4. After the image downloads and runs, you&#8217;ll see the input in the form of a ASCII whale with a &#8220;boo&#8221; caption. Not very profound, I know. You can play around with the image by passing different parameters. Say <ul style="list-style-type: square;">
      <li>
        <code>docker run docker/whalesay cowsay skywide!</code>
      </li>
    </ul>

  5. In order to view all the images on the system, type <ul style="list-style-type: square;">
      <li>
        <code>docker images</code>
      </li>
    </ul>

  6. We&#8217;ll next learn how to build your own images. For now, we&#8217;ll use the above whalesay image and modify it to create our new image

* * *

#### Creating your own Docker image

  1. Create a directory skywide.
  2. CD into the directory
  3. Create a file Dockerfile <ul style="list-style-type: square;">
      <li>
        <code>touch Dockerfile</code>
      </li>
    </ul>

  4. Open Dockerfile in an editor and add the following. <ul style="list-style-type: square;">
      <li>
        <code>&lt;span class="hljs-keyword">FROM&lt;/span> docker/whalesay:latest</code>
      </li>
      <li>
        <code>&lt;span class="hljs-keyword">RUN&lt;/span> &lt;span class="bash">apt-get -y update && apt-get install -y fortunes &lt;/span></code>
      </li>
      <li>
        <code>&lt;span class="hljs-keyword">CMD&lt;/span> &lt;span class="bash">/usr/games/fortune &lt;span class="hljs-_">-a&lt;/span> | cowsay&lt;/span></code>
      </li>
    </ul>

  5. The FROM command tells Docker which image your image is based on. RUN command tells Docker to install the required programs/libraries on your image. CMD tells Docker to run the specified command when the image is run inside a container.
  6. Next, build your image by running <ul style="list-style-type: square;">
      <li>
        <code>docker build -t docker-whale .</code>
      </li>
    </ul>

  7. Docker will build a new image by using the whalesay image that it downloaded earlier and on this new image it will update the apt-get cache and install the software fortunes.
  8. You can then verify that a new image has been built by running docker images. You should now see three images including &#8220;docker-whale&#8221;.
  9. Finally, see your own image in action! Go ahead and run <ul style="list-style-type: square;">
      <li>
        <code>docker run docker-whale</code>
      </li>
    </ul>

* * *

#### Pushing your image to DockerHub

  1. Create a new repository to upload your docker image to. Make sure the repository is public
  2. Note down the image ID from <ul style="list-style-type: square;">
      <li>
        <code>docker images</code>
      </li>
    </ul>

  3. Tag your image with your username <ul style="list-style-type: square;">
      <li>
        <code>docker tag &lt;image-id&gt; &lt;dockerhub-username&gt;/&lt;repository-name&gt;:latest</code>
      </li>
    </ul>

  4. Type docker images again to see your new tagged image
  5. You will need to login to Docker from the terminal before you can push it. To login <ul style="list-style-type: square;">
      <li>
        <code>docker login --username=&lt;username&gt; --email=&lt;docker-email&gt;</code>
      </li>
    </ul>

  6. To push the image to your repo, type <ul style="list-style-type: square;">
      <li>
        <code>docker push &lt;username&gt;/&lt;image-name&gt;</code>
      </li>
    </ul>

  7. Finally, after the command finishes running, go to your DockerHub repository page to find your uploaded image.

&nbsp;
